
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mydomain.org/mysite/">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Práctica 4.1 - Despliegue de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-41-configuracion-de-un-servidor-dns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Despliegue de aplicaciones web" class="md-header__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Despliegue de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 4.1
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Despliegue de aplicaciones web" class="md-nav__button md-logo" aria-label="Despliegue de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Despliegue de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Tema 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Práctica 4.1
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Práctica 4.1
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conexion-mediante-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión mediante SSH
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparacion-del-entorno" class="md-nav__link">
    <span class="md-ellipsis">
      Preparación del entorno
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparación del entorno">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#istalacion-de-bind9" class="md-nav__link">
    <span class="md-ellipsis">
      Istalación de Bind9
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-servidor" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del servidor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-de-los-archivos" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de los archivos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuración de los archivos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namedconfoptions" class="md-nav__link">
    <span class="md-ellipsis">
      named.conf.options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="named.conf.options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lista-de-ips" class="md-nav__link">
    <span class="md-ellipsis">
      Lista de IPs.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#habilitamos-la-recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Habilitamos la recursión
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restricciones-para-las-consultas-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Restricciones para las consultas DNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transferencia-de-zonas" class="md-nav__link">
    <span class="md-ellipsis">
      Transferencia de zonas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-servidor_1" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del servidor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#habilitacion-de-la-recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Habilitación de la recursión
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-total" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración total
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobacion" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#namedconflocal" class="md-nav__link">
    <span class="md-ellipsis">
      named.conf.local
    </span>
  </a>
  
    <nav class="md-nav" aria-label="named.conf.local">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creacion-del-archivo-de-zona" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del archivo de zona
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-del-archivo-de-zona-para-la-resolucion-inversa" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del archivo de zona para la resolución inversa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobacion-de-las-resoluciones-y-las-consultas" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación de las resoluciones y las consultas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cuestiones-finales" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones finales
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conexion-mediante-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión mediante SSH
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparacion-del-entorno" class="md-nav__link">
    <span class="md-ellipsis">
      Preparación del entorno
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparación del entorno">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#istalacion-de-bind9" class="md-nav__link">
    <span class="md-ellipsis">
      Istalación de Bind9
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-servidor" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del servidor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-de-los-archivos" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de los archivos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuración de los archivos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namedconfoptions" class="md-nav__link">
    <span class="md-ellipsis">
      named.conf.options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="named.conf.options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lista-de-ips" class="md-nav__link">
    <span class="md-ellipsis">
      Lista de IPs.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#habilitamos-la-recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Habilitamos la recursión
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restricciones-para-las-consultas-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Restricciones para las consultas DNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transferencia-de-zonas" class="md-nav__link">
    <span class="md-ellipsis">
      Transferencia de zonas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-servidor_1" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del servidor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#habilitacion-de-la-recursion" class="md-nav__link">
    <span class="md-ellipsis">
      Habilitación de la recursión
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-total" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración total
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobacion" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#namedconflocal" class="md-nav__link">
    <span class="md-ellipsis">
      named.conf.local
    </span>
  </a>
  
    <nav class="md-nav" aria-label="named.conf.local">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creacion-del-archivo-de-zona" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del archivo de zona
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-del-archivo-de-zona-para-la-resolucion-inversa" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del archivo de zona para la resolución inversa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobacion-de-las-resoluciones-y-las-consultas" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación de las resoluciones y las consultas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cuestiones-finales" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones finales
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="practica-41-configuracion-de-un-servidor-dns">Práctica 4.1 - Configuración de un servidor DNS</h1>
<h2 id="conexion-mediante-ssh">Conexión mediante SSH</h2>
<p>Para esta práctica nos conectaremos mediante ssh a nuestra máquina virtual. Para ello ejecutamos el comando <code>ssh nuestro_usuario@ip_máquina</code> en el símbolo de sistema de nuestro ordenador.</p>
<p><img alt="Conexión por SSH" src="assets/imagenes/1ConexionSSH.png" /></p>
<h2 id="preparacion-del-entorno">Preparación del entorno</h2>
<p>Es muy importante, que antes de empezar, eliminemos las entradas del archivo <code>/etc/hosts</code> para que las pruebas de resolución se realicen exclusivamente a través del servidor DNS.</p>
<p><img alt="Reparación" src="assets/imagenes/2Reparacion.png" /></p>
<h3 id="istalacion-de-bind9">Istalación de Bind9</h3>
<p>Primero que nada actualizamos nuestro sistema con el comando <code>sudo apt-get update</code> y cuando termine la actualización instalamos bind9, el cual es el estándar de facto para servidores DNS. Esto lo haremos con el comando:</p>
<div class="codehilite"><pre><span></span><code><span class="go">sudo apt-get install bind9 bind9utils bind9-doc</span>
</code></pre></div>

<p>La versión 9 es la recomendada para usarse y la que vamos a utilizar ya que garantiza la interoperabilidad con otros sistemas DNS, haciendo que sea una opción robusta y completa para la mayoría de casos de uso relacionados con servidores DNS.</p>
<p><img alt="Instalación Bind9" src="assets/imagenes/3InstalacionBind9.png" /></p>
<p>Ejecutamos el comando <code>named -v</code> para ver si está instalado correctamente. En mi caso no salía asique tuve que agregarlo a mi PATH.</p>
<p>Agregamos <code>/usr/sbin</code> a nuestro PATH temporalmente con el comando <code>export PATH=$PATH:/usr/sbin</code> y posteriormente ejecutamos el comando <code>named -v</code> otra vez y debería aparecer la versión que tenemos.</p>
<p><img alt="Configuración del PATH" src="assets/imagenes/4ConfiguracionPATH.png" /></p>
<h3 id="configuracion-del-servidor">Configuración del servidor</h3>
<p>Editaremos el archivo general de Bind para indicarle que sólo use IPv4. Este archivo se encuentra en <code>/etc/default</code> y para abrirlo simplemente hay que ejecutar el comando <code>sudo nano /etc/default/named</code>. </p>
<p>Ya solo nos queda cambiar la línea <code>OPTIONS="-u bind"</code> por el texto:</p>
<div class="codehilite"><pre><span></span><code>OPTIONS = &quot;-u bind -4&quot;
</code></pre></div>

<p><img alt="Configuración del Servidor" src="assets/imagenes/5ConfiguracionServidor.png" /></p>
<p>Tras esto tendremos que guardar los cambios con <code>CTRL + X</code> y luego reiniciar el servicio con <code>sudo systemctl restart bind9</code> para comprobar que la configuración ha sido correctamente editada.</p>
<p><img alt="Reinicio Bind9" src="assets/imagenes/6ReinicioBind9.png" /></p>
<p>Ejecutamos el comando <code>sudo nano /etc/bind/named.conf</code> para saber las referencias a los archivos donde deberemos hacer la configuración, ubicados en el mismo directorio.</p>
<p><img alt="archivo named.conf" src="assets/imagenes/7Archivo_namedconf.png" /></p>
<h3 id="configuracion-de-los-archivos">Configuración de los archivos</h3>
<p>Hacer una copia de seguridad de los archivos de configuración cada vez que se va a realizar un cambio es una buena práctica, para así, si causa algun tipo de error siempre se puede volver a la versión anterior.</p>
<h4 id="namedconfoptions"><em>named.conf.options</em></h4>
<p><img alt="Copia de seguridad del archivo named.conf.options" src="assets/imagenes/8CopiaSeguridad.png" /></p>
<p><img alt="Comprobación" src="assets/imagenes/9Comprobacion.png" /></p>
<p>Con este comando lo que estamos haciendo es guardar una copia en del archivo <code>/etc/bind/named.conf.options</code> y de esta manera tener la posibilidad de volver a la configuración inicial.</p>
<p>Ahora viene el momento de proceder a editar el archivo <code>/etc/bind/named.conf.options</code>. Para ello abrimos el archivo con nano y haremos varios cambios en el documento.</p>
<h5 id="lista-de-ips">Lista de IPs.</h5>
<p>Primero, añadimos justo antes del bloque <code>options {...}</code> el siguiente bloque de código:</p>
<div class="codehilite"><pre><span></span><code>acl confiables {
    192.168.X.0/24;
}
</code></pre></div>

<p>En la dirección IP cambiaremos la <code>X</code> por el valor de nuestra red local. En mi caso sería <code>192.168.254.0</code>.</p>
<p><img alt="Edición del archivo con nano" src="assets/imagenes/10Abrimos-configuracion-con-nano.png" />
<img alt="Bloque acl confiables" src="assets/imagenes/11acl-confiables.png" /></p>
<p>Aquí lo que estamos haciendo es crear un bloque donde iremos poniendo las distintas IP que pueden hacer consultas desde nuestra red.</p>
<h5 id="habilitamos-la-recursion">Habilitamos la recursión</h5>
<p>Después, permitimos unicamente las consultas recursivas a los host que hemos decidido en el paso anterior. Para ello tenemos que editar la parte <code>options {...}</code> y añadir la siguiente línea:</p>
<div class="codehilite"><pre><span></span><code>options {
    directory &quot;/var/cache/bind&quot;;

    allow-recursion { confiables; };
}
</code></pre></div>

<p><img alt="Habilitamos la recursividad" src="assets/imagenes/12HabilitamosRecursividad.png" /></p>
<p>De esta forma configuramos que solo pueda realizar consultas recursivas aquellas IP que se encuentren en la lista <code>confiables</code> que hemos creado anteriormente.</p>
<h5 id="restricciones-para-las-consultas-dns">Restricciones para las consultas DNS</h5>
<p>Posteriormente definimos quién puede realizar consultas DNS al servidor, dando permiso sólo a las direcciones que hay en la lista <code>confiables</code>. Para ello añadimos <code>allow-query { confiables; };</code> al bloque de código <code>options {...}</code>.</p>
<p><img alt="Restricciones para las consultas DNS" src="assets/imagenes/13ConsultasDNS-servidor.png" /></p>
<h5 id="transferencia-de-zonas">Transferencia de zonas</h5>
<p>En este apartado lo que haremos será añadir una línea más a nuestro bloque <code>options {...}</code> como venimios haciendo hasta ahora. En este caso será la línea <code>allow-transfer { none; };</code>. Lo que hacemos con esto es impider las transferencias de zona, las cuales son copias completas de las bases de datos DNS.</p>
<p>Básicamente lo que estamos haciendo, es añadir una medida de seguridad para que otros servidores no puedan obtener información sobre las zonas configuradas en el servidor.</p>
<p><img alt="Transferencia de zonas" src="assets/imagenes/14TransferenciaZonas.png" /></p>
<h5 id="configuracion-del-servidor_1">Configuración del servidor</h5>
<p>Configuramos el servidor para que escuche consultas DNS en el puerto 53 y en la IP de su interfaz de la red privada colocando la IP de la interfaz de nuestra máquina Debian.</p>
<p>Para ello simplemente hay que añadir la línea <code>listen-on port 53{ 192.168.254.1; };</code> en la siguiente línea.</p>
<p><img alt="Consultas DNS en el puerto 53" src="assets/imagenes/15Puerto53.png" /></p>
<h5 id="habilitacion-de-la-recursion">Habilitación de la recursión</h5>
<p>Ahora habilitaremos la recursividad para que el servidor DNS pueda realizar consultas recursivas. Para ello simplemente añadimos la línea <code>recursion yes;</code> en la siguiente línea. Esto lo que va a hacer es hacer que el servidor pueda buscar respuestas en otros servidores DNS si no obtiene la respuesta localmente.</p>
<p><img alt="Habilitación de la recursión" src="assets/imagenes/16HabilitamosRecursion.png" /></p>
<h5 id="configuracion-total">Configuración total</h5>
<p>Finalmente, con los cambios realizados, el archivo <code>/etc/bind/named.conf.options</code> quedaría de esta manera:</p>
<p><img alt="Configuración total" src="assets/imagenes/17ConfiguracionTotal.png" /></p>
<blockquote>
<p>ℹ️Info</p>
<p>Con la línea <code>dnssec-validation yes;</code> lo que estamos haciendo es habilitar activar la validación de las respuestas DNS usando DNSSEC.</p>
<p>De esta forma garantizamos la seguridad e integridad del sistema DNS y lo protegemos contra ataques como <strong>DNS spoofing</strong> o <strong>cache poisoning</strong>, los cuales son ataques que compromenten el sistema DNS redirigiendo el tráfico de usuarios hacia otros sitios maliciosos aunque el dominio solicitado parezca legítimo.</p>
</blockquote>
<h5 id="comprobacion">Comprobación</h5>
<p>Finalmente para comprobar que el archivo está correctamente configurado simplemente hay que ejecutar el comando:  </p>
<div class="codehilite"><pre><span></span><code>sudo named-checkconf
</code></pre></div>

<p><img alt="Comprobación de la configuración" src="assets/imagenes/18ComprobacionConfiguracion.png" /></p>
<p>Si todo está correcto, no mostrará ningún mensaje de error y tenemos que proceder a reiniciar el servicio con el comando <code>sudo systemctl restart bind9</code>.</p>
<p><img alt="Reinicio Bind9" src="assets/imagenes/19ReinicioBind9.png" /></p>
<p>En el caso de que al ejecutar el comando <code>sudo named-checkconf</code> nos de algun error, simplemente tenemos que ir a la línea que nos dice y colocar los datos que te proporciona al lanzar dicho error. Por ejemplo, si te ha faltado un <code>;</code> te pondrá algo tal que:</p>
<p><img alt="Mensaje Error" src="assets/imagenes/20MensajeError.png" /></p>
<p>Aquí lo que te está diciendo el error es que falta un <code>;</code> al final del primer bloque que hemos creado, justo antes de <code>options {...}</code>.</p>
<h4 id="namedconflocal"><em>named.conf.local</em></h4>
<p>Este caso solo necesitaremos añadir un par de líneas indicando que el servidor DNS es maestro en esta zona y le indicaremos dónde estará ubicado el archivo de zona que crearemos.</p>
<p>Para ello primero tenemos que guardar la configuración por defecto como hicimos con el archivo anterior, para tener una opción de poder volver a la configuración inicial. Simplemente tenemos que ejecutar el comando <code>sudo cp /etc/bind/named.conf.local /etc/bind/named.conf.local.backup</code> y ya estaría hecha la copia de seguridad y podemos proceder a cambiar la configuración de dicho archivo.</p>
<p><img alt="Copia de seguridad del archivo named.conf.local" src="assets/imagenes/21CopiaSeguridad.png" /></p>
<p>Después de haber hecho la copia de seguridad tenemos que añadir el siguiente bloque de texto:</p>
<div class="codehilite"><pre><span></span><code>zone &quot;deaw.es&quot; {
    type master;
    file &quot;/etc/bind/zones/db.deaw.es&quot;;   // Ruta donde ubicaremos nuestro archivo de zona
};
</code></pre></div>

<p><img alt="Ruta donde ubicamos nuestro archivo de zona" src="assets/imagenes/22RutaArchivoZona.png" /></p>
<h5 id="creacion-del-archivo-de-zona">Creación del archivo de zona</h5>
<p>Ahora procedemos a configurar el archivo de zona de resolución directa justo en el directorio que hemos indicado antes y con el mismo nombre que hemos indicado en el archivo de configuración local.</p>
<p>Para ello primero tenemos que crear el archivo <code>/etc/bind/zones/db.deaw.es</code> que es en el que añdiremos la siguiente información:</p>
<div class="codehilite"><pre><span></span><code>$TTL    604800
@       IN      SOA     debian.deaw.es. admin.deaw.es. (
                ; Cualquier valor numérico es OK para el serial
                ; pero recomendado: [AñoMesDiaVersion]
                2025011401  ;Serial
                3600        ;Refresh
                1800        ;Retry
                604800      ;Expire
                86400       ;Minimum TTL
        )

        ;Definimos el servidor de nombres
        IN NS debian.deaw.es.

;Definimos la IP del servidor de nombres
debian IN A 192.168.254.1
</code></pre></div>

<p>En este archivo lo que estamos haciendo es establecer un tiempo de vida de 7 días para los registros de la zona. Esto quiere decir que durante ese periodo de tiempo, los registros serán almacenados en caché por otros servidores.</p>
<p>En el apartado <code>@ IN SOA debian.deaw.es admin.deaw.es</code> lo que hacemos es declarar el nombre del servidor principal que administra esta zona y indicarle el correo del administrador del servidor (en servidores DNS, el <code>.</code> remplaza al <code>@</code>).</p>
<p>Los parámetros que le pasamos al <code>SOA</code> son:</p>
<ul>
<li><code>2025011401</code>: Número de serie, usando la fecha de hoy (14/01/2025) en formato AñoMesDia y también añadimos la version que en este caso sería la 01.</li>
<li><code>3600</code>: Intervalo de tiempo que los servidores secundarios es:peran antes de pedir actualizaciones</li>
<li><code>1800</code>: tiempo para reintentar después de un fallo.</li>
<li><code>604800</code>: Tiempo tras el cual, los secundarios dejan de usar la zona si no reciben actualizaciones.</li>
<li><code>86400</code>: Tiempo mínimo de caché para los registros negativos (cuando no se encuentra un dominio).</li>
</ul>
<p>En el apartado <code>IN NS debian.deaw.es.</code> definimos el servidor de nombres para la zona indicada.</p>
<p>Con <code>debian IN A 192.168.254.1</code> lo que queremos es asociar el nombre <code>debian</code> al registro A, con la dirección IP <code>192.168.254.1</code>.</p>
<p>En resumen, este archivo lo que hace es configurar el dominio deaw.es, gestionado por el servidor <code>debian.deaw.es.</code> con la IP de mi servidor local. Los parámetros del SOA definen como interactúan los servidores primarios y secundarios.</p>
<p><img alt="Configuración del dominio deaw.es" src="assets/imagenes/23Configuracion-deaw.es.png" /></p>
<h5 id="creacion-del-archivo-de-zona-para-la-resolucion-inversa">Creación del archivo de zona para la resolución inversa</h5>
<p>Ahora procedemos a configurar la zona inversa. Para ello primero tenemos que editar el archivo <code>named.conf.local</code> y añadir el bloque de la zona inversa:</p>
<div class="codehilite"><pre><span></span><code>zone &quot;254.168.192.in-addr.arpa&quot; {
    type master;
    file &quot;/etc/bind/zones/db.254.168.192&quot;;  // Ruta donde ubicaremos nuestro archivo de zona
};
</code></pre></div>

<p><img alt="Ruta archivo de zona de resolución inversa" src="assets/imagenes/24RutaArchivoZonaResolucionInversa.png" /></p>
<p>Luego, también debemos crear y editar el archivo <code>/etc/bind/zones/db.254.168.192</code> en el que pondremos algo similar al archivo del paso anterior.</p>
<div class="codehilite"><pre><span></span><code>$TTL    604800
@       IN      SOA     debian.deaw.es. admin.deaw.es. (
                ; Cualquier valor numérico es OK para el serial
                ; pero recomendado: [AñoMesDiaVersion]
                2025011401  ;Serial
                3600        ;Refresh
                1800        ;Retry
                604800      ;Expire
                86400       ;Minimum TTL
        )

        ;Definimos el servidor de nombres
        IN NS debian.deaw.es.

; Registros PTR
1 IN PTR debian.deaw.es.
</code></pre></div>

<p>Este bloque es similar al anterior con el cambio de que se configura el registro PTR para la dirección IP <code>192.168.254.1</code>, que se resuelve al nombre <code>debian.deaw.es.</code>.</p>
<p><img alt="Configuración registro PTR" src="assets/imagenes/25ConfiguracionRegistroPTR.png" /></p>
<p>Para comprobar si la configuración que hemos hecho está hecha correctamente simplemente tenemos que ejcutar los siguientes comandos:</p>
<div class="codehilite"><pre><span></span><code>sudo named-checkzone 254.168.192.in-addr.arpa /etc/bind/zones/db.254.168.192

sudo named-checkzone 254.168.192.in-addr.arpa /etc/bind/zones/db.deaw.es
</code></pre></div>

<p>Si todo está correctamente configurado tenemos que ver un mensaje como los siguientes:</p>
<p><img alt="Mensaje de que está correctamente configurado" src="assets/imagenes/26MensajeConfirmacion.png" /></p>
<p><img alt="Mensaje de que está correctamente configurado" src="assets/imagenes/27MensajeConfirmacion.png" /></p>
<p>Si todo está correctamente configurado, procedemos a reiniciar el servicio y a comprobar el estado con el mismo comando que en los primeros pasos <code>sudo systemctl restart named</code> y <code>sudo systemctl status named</code>.</p>
<p><img alt="Renicio de Bind9" src="assets/imagenes/28ReinicioBind9.png" /></p>
<h3 id="comprobacion-de-las-resoluciones-y-las-consultas">Comprobación de las resoluciones y las consultas</h3>
<p>Con el comando <code>dig debian.deaw.es</code> y <code>dig -x 192.168.254.1</code> podemos comprobar las resoluciones directas e inversas que hemos configurado anteriormente.</p>
<p><img alt="Comprobación de la resolución directa" src="assets/imagenes/29ComprobacionResolucionDirecta.png" /></p>
<p><img alt="Comprobación de la resolución inversa" src="assets/imagenes/30ComprobacionResolucionInversa.png" /></p>
<h2 id="cuestiones-finales">Cuestiones finales</h2>
<blockquote>
<p>✏️Cuestión 1</p>
<p>¿Qué pasará si un cliente de una red diferente a la tuya intenta hacer uso de tu DNS de alguna manera, le funcionará?¿Por qué, en qué parte de la configuración puede verse?</p>
</blockquote>
<p>Como ya se ha respondido durante la documentación, no le funcionaría ya que en la configuración del servidor DNS hemos especificado una lista de acceso (ACL) en el archivo <code>/etc/bind/named.conf.options</code>. En ese archivo se ha especificado que sólo los clientes de la red <code>192.168.254.0/24</code> están autorizados a hacer consultas recursivas indicandose así en las directivas <code>allow-recursion</code> y <code>allow-query</code>.</p>
<blockquote>
<p>✏️Cuestión 2</p>
<p>¿Por qué tenemos que permitir las consultas recursivas en la configuración?</p>
</blockquote>
<p>Al permitir las consultas recursivas, lo que estamos haciendo es que el servidor DNS no solo resuelva nombres dentro de sus zonas configuradas, si no que también pueda buscar la información en otros servidores DNS si el nombre no está disponible directamente. Esto es importante para permitir que los clientes puedan acceder a cualquier dominio en Internet que no esté directamente configurado en tu servicio DNS. En resumen, sin consultas recursivas, el servidor solo podrá responder por los dominios de su propia zona autoritativa.</p>
<blockquote>
<p>✏️Cuestión 3</p>
<p>El servidor DNS que acabáis de montar, ¿es autoritativo?¿Por qué?</p>
</blockquote>
<p>Sí, ya que lo hemos configurado como servidor maestro para esa zona y es responsable de proporcionar respuestas definitivas para los dominios dentro de la zona especificada.</p>
<blockquote>
<p>✏️Cuestión 4</p>
<p>¿Dónde podemos encontrar la directiva $ORIGIN y para qué sirve?</p>
</blockquote>
<p>La podemos encontrar dentro de los archivos de zona, como por ejemplo en el archivo <code>/etc/bid/zones/db.deaw.es</code>. Sirve para definir el dominio base para los registros DNS dentro de ese archivo. Es útil para evitar la repetición del nombre de dominio completo en cada registro. </p>
<blockquote>
<p>✏️Cuestión 5</p>
<p>¿Una zona es idéntico a un dominio?</p>
</blockquote>
<p>Una zona y un dominio no son lo mismo pero están relacionados entre sí.
* Una zona es una porción de la jerarquía de nombres de dominio que es administrada por un servidor DNS
* Un dominio es un nombre único en la jerarquía de DNS, pero no necesariamente se corresponde con una zona completa.</p>
<blockquote>
<p>✏️Cuestión 6</p>
<p>¿Pueden editarse los archivos de zona de un servidor esclavo/secundario?</p>
</blockquote>
<p>No deben ser editados manualmente. Si se necesitan hacer cambios en los registros de la zona, se debe hacer en el servidor maestros y luego los esclavos recibirán la actualización automáticamente.</p>
<blockquote>
<p>✏️Cuestión 7</p>
<p>¿Por qué podría querer tener más de un servidor esclavo para una misma zona?</p>
</blockquote>
<p>Porque si un servidor esclavo falla o se desconecta, otros pueden seguir respondiendo a las consultas DNS. Esto es especialmente importante para garantizar que el servicio DNS siempre esté disponible y no dependa de un solo servidor, de esta forma mejorar la resiliencia y la disponibilidad del servicio.</p>
<blockquote>
<p>✏️Cuestión 8</p>
<p>¿Cuántos servidores raíz existen?</p>
</blockquote>
<p>Existen 13 servidores raíz en todo el mundo. Estos servidores son responsables de dirigir las consultas de DNS hacia los servidores de nombres autoritativos adecuados para resolver los dominios.</p>
<p>Estos servidores son:</p>
<table>
<thead>
<tr>
<th>Letra</th>
<th>Operador</th>
<th>Dirección IPv4</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>Verisign</td>
<td>198.41.0.4</td>
</tr>
<tr>
<td>B</td>
<td>USC-ISI</td>
<td>192.228.79.201</td>
</tr>
<tr>
<td>C</td>
<td>Cogent Communications</td>
<td>192.33.4.12</td>
</tr>
<tr>
<td>D</td>
<td>Universidad de Maryland</td>
<td>199.7.91.139</td>
</tr>
<tr>
<td>E</td>
<td>NASA</td>
<td>192.203.230.10</td>
</tr>
<tr>
<td>F</td>
<td>Internet Systems Consortium</td>
<td>192.5.5.241</td>
</tr>
<tr>
<td>G</td>
<td>Defense Information Systems</td>
<td>192.112.36.4</td>
</tr>
<tr>
<td>H</td>
<td>U.S. Army Research Lab</td>
<td>128.63.2.53</td>
</tr>
<tr>
<td>I</td>
<td>Netnod</td>
<td>192.36.148.17</td>
</tr>
<tr>
<td>J</td>
<td>Verisign</td>
<td>192.58.128.30</td>
</tr>
<tr>
<td>K</td>
<td>RIPE NCC</td>
<td>193.0.14.129</td>
</tr>
<tr>
<td>L</td>
<td>ICANN</td>
<td>199.7.83.42</td>
</tr>
<tr>
<td>M</td>
<td>Proyecto WIDE</td>
<td>202.12.27.33</td>
</tr>
</tbody>
</table>
<blockquote>
<p>✏️Cuestión 9</p>
<p>¿Qué es una consulta iterativa de referencia?</p>
</blockquote>
<p>Una consulta iterativa de referencia es cuando un servidor DNS no resuelve completamente una consulta, sino que devuelve una referencia a otro servidor que puede ser capaz de hacerelo. El cliente debe seguir consultando a esos servidores de referencia hasta obtener una respuesta definitiva. </p>
<blockquote>
<p>✏️Cuestión 10</p>
<p>En una resolución inversa, ¿a qué nombre se mapearía la dirección IP 172.16.34.56?</p>
</blockquote>
<p>En una resolución inversa, la dirección IP <code>172.16.34.56</code> se convertiría en un nombre de dominio siguiendo la estructura de una zona de resolución inversa. El resultado final se expresaría como:</p>
<div class="codehilite"><pre><span></span><code>56.34.16.172.in-addr.arpa
</code></pre></div>

<hr />
<p>Autor: Jorge Pradillo Hinterberger</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["highlight"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>