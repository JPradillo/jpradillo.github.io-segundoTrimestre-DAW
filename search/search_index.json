{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Pr\u00e1ctica 4.1 - Configuraci\u00f3n de un servidor DNS","text":""},{"location":"#conexion-mediante-ssh","title":"Conexi\u00f3n mediante SSH","text":"<p>Para esta pr\u00e1ctica nos conectaremos mediante ssh a nuestra m\u00e1quina virtual. Para ello ejecutamos el comando <code>ssh nuestro_usuario@ip_m\u00e1quina</code> en el s\u00edmbolo de sistema de nuestro ordenador.</p> <p></p>"},{"location":"#preparacion-del-entorno","title":"Preparaci\u00f3n del entorno","text":"<p>Es muy importante, que antes de empezar, eliminemos las entradas del archivo <code>/etc/hosts</code> para que las pruebas de resoluci\u00f3n se realicen exclusivamente a trav\u00e9s del servidor DNS.</p> <p></p>"},{"location":"#istalacion-de-bind9","title":"Istalaci\u00f3n de Bind9","text":"<p>Primero que nada actualizamos nuestro sistema con el comando <code>sudo apt-get update</code> y cuando termine la actualizaci\u00f3n instalamos bind9, el cual es el est\u00e1ndar de facto para servidores DNS. Esto lo haremos con el comando:</p> <pre><code>sudo apt-get install bind9 bind9utils bind9-doc\n</code></pre> <p>La versi\u00f3n 9 es la recomendada para usarse y la que vamos a utilizar ya que garantiza la interoperabilidad con otros sistemas DNS, haciendo que sea una opci\u00f3n robusta y completa para la mayor\u00eda de casos de uso relacionados con servidores DNS.</p> <p></p> <p>Ejecutamos el comando <code>named -v</code> para ver si est\u00e1 instalado correctamente. En mi caso no sal\u00eda asique tuve que agregarlo a mi PATH.</p> <p>Agregamos <code>/usr/sbin</code> a nuestro PATH temporalmente con el comando <code>export PATH=$PATH:/usr/sbin</code> y posteriormente ejecutamos el comando <code>named -v</code> otra vez y deber\u00eda aparecer la versi\u00f3n que tenemos.</p> <p></p>"},{"location":"#configuracion-del-servidor","title":"Configuraci\u00f3n del servidor","text":"<p>Editaremos el archivo general de Bind para indicarle que s\u00f3lo use IPv4. Este archivo se encuentra en <code>/etc/default</code> y para abrirlo simplemente hay que ejecutar el comando <code>sudo nano /etc/default/named</code>. </p> <p>Ya solo nos queda cambiar la l\u00ednea <code>OPTIONS=\"-u bind\"</code> por el texto:</p> <pre><code>OPTIONS = \"-u bind -4\"\n</code></pre> <p></p> <p>Tras esto tendremos que guardar los cambios con <code>CTRL + X</code> y luego reiniciar el servicio con <code>sudo systemctl restart bind9</code> para comprobar que la configuraci\u00f3n ha sido correctamente editada.</p> <p></p> <p>Ejecutamos el comando <code>sudo nano /etc/bind/named.conf</code> para saber las referencias a los archivos donde deberemos hacer la configuraci\u00f3n, ubicados en el mismo directorio.</p> <p></p>"},{"location":"#configuracion-de-los-archivos","title":"Configuraci\u00f3n de los archivos","text":"<p>Hacer una copia de seguridad de los archivos de configuraci\u00f3n cada vez que se va a realizar un cambio es una buena pr\u00e1ctica, para as\u00ed, si causa algun tipo de error siempre se puede volver a la versi\u00f3n anterior.</p>"},{"location":"#namedconfoptions","title":"named.conf.options","text":"<p>Con este comando lo que estamos haciendo es guardar una copia en del archivo <code>/etc/bind/named.conf.options</code> y de esta manera tener la posibilidad de volver a la configuraci\u00f3n inicial.</p> <p>Ahora viene el momento de proceder a editar el archivo <code>/etc/bind/named.conf.options</code>. Para ello abrimos el archivo con nano y haremos varios cambios en el documento.</p>"},{"location":"#lista-de-ips","title":"Lista de IPs.","text":"<p>Primero, a\u00f1adimos justo antes del bloque <code>options {...}</code> el siguiente bloque de c\u00f3digo:</p> <pre><code>acl confiables {\n    192.168.X.0/24;\n}\n</code></pre> <p>En la direcci\u00f3n IP cambiaremos la <code>X</code> por el valor de nuestra red local. En mi caso ser\u00eda <code>192.168.254.0</code>.</p> <p> </p> <p>Aqu\u00ed lo que estamos haciendo es crear un bloque donde iremos poniendo las distintas IP que pueden hacer consultas desde nuestra red.</p>"},{"location":"#habilitamos-la-recursion","title":"Habilitamos la recursi\u00f3n","text":"<p>Despu\u00e9s, permitimos unicamente las consultas recursivas a los host que hemos decidido en el paso anterior. Para ello tenemos que editar la parte <code>options {...}</code> y a\u00f1adir la siguiente l\u00ednea:</p> <pre><code>options {\n    directory \"/var/cache/bind\";\n\n    allow-recursion { confiables; };\n}\n</code></pre> <p></p> <p>De esta forma configuramos que solo pueda realizar consultas recursivas aquellas IP que se encuentren en la lista <code>confiables</code> que hemos creado anteriormente.</p>"},{"location":"#restricciones-para-las-consultas-dns","title":"Restricciones para las consultas DNS","text":"<p>Posteriormente definimos qui\u00e9n puede realizar consultas DNS al servidor, dando permiso s\u00f3lo a las direcciones que hay en la lista <code>confiables</code>. Para ello a\u00f1adimos <code>allow-query { confiables; };</code> al bloque de c\u00f3digo <code>options {...}</code>.</p> <p></p>"},{"location":"#transferencia-de-zonas","title":"Transferencia de zonas","text":"<p>En este apartado lo que haremos ser\u00e1 a\u00f1adir una l\u00ednea m\u00e1s a nuestro bloque <code>options {...}</code> como venimios haciendo hasta ahora. En este caso ser\u00e1 la l\u00ednea <code>allow-transfer { none; };</code>. Lo que hacemos con esto es impider las transferencias de zona, las cuales son copias completas de las bases de datos DNS.</p> <p>B\u00e1sicamente lo que estamos haciendo, es a\u00f1adir una medida de seguridad para que otros servidores no puedan obtener informaci\u00f3n sobre las zonas configuradas en el servidor.</p> <p></p>"},{"location":"#configuracion-del-servidor_1","title":"Configuraci\u00f3n del servidor","text":"<p>Configuramos el servidor para que escuche consultas DNS en el puerto 53 y en la IP de su interfaz de la red privada colocando la IP de la interfaz de nuestra m\u00e1quina Debian.</p> <p>Para ello simplemente hay que a\u00f1adir la l\u00ednea <code>listen-on port 53{ 192.168.254.1; };</code> en la siguiente l\u00ednea.</p> <p></p>"},{"location":"#habilitacion-de-la-recursion","title":"Habilitaci\u00f3n de la recursi\u00f3n","text":"<p>Ahora habilitaremos la recursividad para que el servidor DNS pueda realizar consultas recursivas. Para ello simplemente a\u00f1adimos la l\u00ednea <code>recursion yes;</code> en la siguiente l\u00ednea. Esto lo que va a hacer es hacer que el servidor pueda buscar respuestas en otros servidores DNS si no obtiene la respuesta localmente.</p> <p></p>"},{"location":"#configuracion-total","title":"Configuraci\u00f3n total","text":"<p>Finalmente, con los cambios realizados, el archivo <code>/etc/bind/named.conf.options</code> quedar\u00eda de esta manera:</p> <p></p> <p>\u2139\ufe0fInfo</p> <p>Con la l\u00ednea <code>dnssec-validation yes;</code> lo que estamos haciendo es habilitar activar la validaci\u00f3n de las respuestas DNS usando DNSSEC.</p> <p>De esta forma garantizamos la seguridad e integridad del sistema DNS y lo protegemos contra ataques como DNS spoofing o cache poisoning, los cuales son ataques que compromenten el sistema DNS redirigiendo el tr\u00e1fico de usuarios hacia otros sitios maliciosos aunque el dominio solicitado parezca leg\u00edtimo.</p>"},{"location":"#comprobacion","title":"Comprobaci\u00f3n","text":"<p>Finalmente para comprobar que el archivo est\u00e1 correctamente configurado simplemente hay que ejecutar el comando:  </p> <pre><code>sudo named-checkconf\n</code></pre> <p></p> <p>Si todo est\u00e1 correcto, no mostrar\u00e1 ning\u00fan mensaje de error y tenemos que proceder a reiniciar el servicio con el comando <code>sudo systemctl restart bind9</code>.</p> <p></p> <p>En el caso de que al ejecutar el comando <code>sudo named-checkconf</code> nos de algun error, simplemente tenemos que ir a la l\u00ednea que nos dice y colocar los datos que te proporciona al lanzar dicho error. Por ejemplo, si te ha faltado un <code>;</code> te pondr\u00e1 algo tal que:</p> <p></p> <p>Aqu\u00ed lo que te est\u00e1 diciendo el error es que falta un <code>;</code> al final del primer bloque que hemos creado, justo antes de <code>options {...}</code>.</p>"},{"location":"#namedconflocal","title":"named.conf.local","text":"<p>Este caso solo necesitaremos a\u00f1adir un par de l\u00edneas indicando que el servidor DNS es maestro en esta zona y le indicaremos d\u00f3nde estar\u00e1 ubicado el archivo de zona que crearemos.</p> <p>Para ello primero tenemos que guardar la configuraci\u00f3n por defecto como hicimos con el archivo anterior, para tener una opci\u00f3n de poder volver a la configuraci\u00f3n inicial. Simplemente tenemos que ejecutar el comando <code>sudo cp /etc/bind/named.conf.local /etc/bind/named.conf.local.backup</code> y ya estar\u00eda hecha la copia de seguridad y podemos proceder a cambiar la configuraci\u00f3n de dicho archivo.</p> <p></p> <p>Despu\u00e9s de haber hecho la copia de seguridad tenemos que a\u00f1adir el siguiente bloque de texto:</p> <pre><code>zone \"deaw.es\" {\n    type master;\n    file \"/etc/bind/zones/db.deaw.es\";   // Ruta donde ubicaremos nuestro archivo de zona\n};\n</code></pre> <p></p>"},{"location":"#creacion-del-archivo-de-zona","title":"Creaci\u00f3n del archivo de zona","text":"<p>Ahora procedemos a configurar el archivo de zona de resoluci\u00f3n directa justo en el directorio que hemos indicado antes y con el mismo nombre que hemos indicado en el archivo de configuraci\u00f3n local.</p> <p>Para ello primero tenemos que crear el archivo <code>/etc/bind/zones/db.deaw.es</code> que es en el que a\u00f1diremos la siguiente informaci\u00f3n:</p> <pre><code>$TTL    604800\n@       IN      SOA     debian.deaw.es. admin.deaw.es. (\n                ; Cualquier valor num\u00e9rico es OK para el serial\n                ; pero recomendado: [A\u00f1oMesDiaVersion]\n                2025011401  ;Serial\n                3600        ;Refresh\n                1800        ;Retry\n                604800      ;Expire\n                86400       ;Minimum TTL\n        )\n\n        ;Definimos el servidor de nombres\n        IN NS debian.deaw.es.\n\n;Definimos la IP del servidor de nombres\ndebian IN A 192.168.254.1\n</code></pre> <p>En este archivo lo que estamos haciendo es establecer un tiempo de vida de 7 d\u00edas para los registros de la zona. Esto quiere decir que durante ese periodo de tiempo, los registros ser\u00e1n almacenados en cach\u00e9 por otros servidores.</p> <p>En el apartado <code>@ IN SOA debian.deaw.es admin.deaw.es</code> lo que hacemos es declarar el nombre del servidor principal que administra esta zona y indicarle el correo del administrador del servidor (en servidores DNS, el <code>.</code> remplaza al <code>@</code>).</p> <p>Los par\u00e1metros que le pasamos al <code>SOA</code> son:</p> <ul> <li><code>2025011401</code>: N\u00famero de serie, usando la fecha de hoy (14/01/2025) en formato A\u00f1oMesDia y tambi\u00e9n a\u00f1adimos la version que en este caso ser\u00eda la 01.</li> <li><code>3600</code>: Intervalo de tiempo que los servidores secundarios es:peran antes de pedir actualizaciones</li> <li><code>1800</code>: tiempo para reintentar despu\u00e9s de un fallo.</li> <li><code>604800</code>: Tiempo tras el cual, los secundarios dejan de usar la zona si no reciben actualizaciones.</li> <li><code>86400</code>: Tiempo m\u00ednimo de cach\u00e9 para los registros negativos (cuando no se encuentra un dominio).</li> </ul> <p>En el apartado <code>IN NS debian.deaw.es.</code> definimos el servidor de nombres para la zona indicada.</p> <p>Con <code>debian IN A 192.168.254.1</code> lo que queremos es asociar el nombre <code>debian</code> al registro A, con la direcci\u00f3n IP <code>192.168.254.1</code>.</p> <p>En resumen, este archivo lo que hace es configurar el dominio deaw.es, gestionado por el servidor <code>debian.deaw.es.</code> con la IP de mi servidor local. Los par\u00e1metros del SOA definen como interact\u00faan los servidores primarios y secundarios.</p> <p></p>"},{"location":"#creacion-del-archivo-de-zona-para-la-resolucion-inversa","title":"Creaci\u00f3n del archivo de zona para la resoluci\u00f3n inversa","text":"<p>Ahora procedemos a configurar la zona inversa. Para ello primero tenemos que editar el archivo <code>named.conf.local</code> y a\u00f1adir el bloque de la zona inversa:</p> <pre><code>zone \"254.168.192.in-addr.arpa\" {\n    type master;\n    file \"/etc/bind/zones/db.254.168.192\";  // Ruta donde ubicaremos nuestro archivo de zona\n};\n</code></pre> <p></p> <p>Luego, tambi\u00e9n debemos crear y editar el archivo <code>/etc/bind/zones/db.254.168.192</code> en el que pondremos algo similar al archivo del paso anterior.</p> <pre><code>$TTL    604800\n@       IN      SOA     debian.deaw.es. admin.deaw.es. (\n                ; Cualquier valor num\u00e9rico es OK para el serial\n                ; pero recomendado: [A\u00f1oMesDiaVersion]\n                2025011401  ;Serial\n                3600        ;Refresh\n                1800        ;Retry\n                604800      ;Expire\n                86400       ;Minimum TTL\n        )\n\n        ;Definimos el servidor de nombres\n        IN NS debian.deaw.es.\n\n; Registros PTR\n1 IN PTR debian.deaw.es.\n</code></pre> <p>Este bloque es similar al anterior con el cambio de que se configura el registro PTR para la direcci\u00f3n IP <code>192.168.254.1</code>, que se resuelve al nombre <code>debian.deaw.es.</code>.</p> <p></p> <p>Para comprobar si la configuraci\u00f3n que hemos hecho est\u00e1 hecha correctamente simplemente tenemos que ejcutar los siguientes comandos:</p> <pre><code>sudo named-checkzone 254.168.192.in-addr.arpa /etc/bind/zones/db.254.168.192\n\nsudo named-checkzone 254.168.192.in-addr.arpa /etc/bind/zones/db.deaw.es\n</code></pre> <p>Si todo est\u00e1 correctamente configurado tenemos que ver un mensaje como los siguientes:</p> <p></p> <p></p> <p>Si todo est\u00e1 correctamente configurado, procedemos a reiniciar el servicio y a comprobar el estado con el mismo comando que en los primeros pasos <code>sudo systemctl restart named</code> y <code>sudo systemctl status named</code>.</p> <p></p>"},{"location":"#comprobacion-de-las-resoluciones-y-las-consultas","title":"Comprobaci\u00f3n de las resoluciones y las consultas","text":"<p>Con el comando <code>dig debian.deaw.es</code> y <code>dig -x 192.168.254.1</code> podemos comprobar las resoluciones directas e inversas que hemos configurado anteriormente.</p> <p></p> <p></p>"},{"location":"#cuestiones-finales","title":"Cuestiones finales","text":"<p>\u270f\ufe0fCuesti\u00f3n 1</p> <p>\u00bfQu\u00e9 pasar\u00e1 si un cliente de una red diferente a la tuya intenta hacer uso de tu DNS de alguna manera, le funcionar\u00e1?\u00bfPor qu\u00e9, en qu\u00e9 parte de la configuraci\u00f3n puede verse?</p> <p>Como ya se ha respondido durante la documentaci\u00f3n, no le funcionar\u00eda ya que en la configuraci\u00f3n del servidor DNS hemos especificado una lista de acceso (ACL) en el archivo <code>/etc/bind/named.conf.options</code>. En ese archivo se ha especificado que s\u00f3lo los clientes de la red <code>192.168.254.0/24</code> est\u00e1n autorizados a hacer consultas recursivas indicandose as\u00ed en las directivas <code>allow-recursion</code> y <code>allow-query</code>.</p> <p>\u270f\ufe0fCuesti\u00f3n 2</p> <p>\u00bfPor qu\u00e9 tenemos que permitir las consultas recursivas en la configuraci\u00f3n?</p> <p>Al permitir las consultas recursivas, lo que estamos haciendo es que el servidor DNS no solo resuelva nombres dentro de sus zonas configuradas, si no que tambi\u00e9n pueda buscar la informaci\u00f3n en otros servidores DNS si el nombre no est\u00e1 disponible directamente. Esto es importante para permitir que los clientes puedan acceder a cualquier dominio en Internet que no est\u00e9 directamente configurado en tu servicio DNS. En resumen, sin consultas recursivas, el servidor solo podr\u00e1 responder por los dominios de su propia zona autoritativa.</p> <p>\u270f\ufe0fCuesti\u00f3n 3</p> <p>El servidor DNS que acab\u00e1is de montar, \u00bfes autoritativo?\u00bfPor qu\u00e9?</p> <p>S\u00ed, ya que lo hemos configurado como servidor maestro para esa zona y es responsable de proporcionar respuestas definitivas para los dominios dentro de la zona especificada.</p> <p>\u270f\ufe0fCuesti\u00f3n 4</p> <p>\u00bfD\u00f3nde podemos encontrar la directiva $ORIGIN y para qu\u00e9 sirve?</p> <p>La podemos encontrar dentro de los archivos de zona, como por ejemplo en el archivo <code>/etc/bid/zones/db.deaw.es</code>. Sirve para definir el dominio base para los registros DNS dentro de ese archivo. Es \u00fatil para evitar la repetici\u00f3n del nombre de dominio completo en cada registro. </p> <p>\u270f\ufe0fCuesti\u00f3n 5</p> <p>\u00bfUna zona es id\u00e9ntico a un dominio?</p> <p>Una zona y un dominio no son lo mismo pero est\u00e1n relacionados entre s\u00ed. * Una zona es una porci\u00f3n de la jerarqu\u00eda de nombres de dominio que es administrada por un servidor DNS * Un dominio es un nombre \u00fanico en la jerarqu\u00eda de DNS, pero no necesariamente se corresponde con una zona completa.</p> <p>\u270f\ufe0fCuesti\u00f3n 6</p> <p>\u00bfPueden editarse los archivos de zona de un servidor esclavo/secundario?</p> <p>No deben ser editados manualmente. Si se necesitan hacer cambios en los registros de la zona, se debe hacer en el servidor maestros y luego los esclavos recibir\u00e1n la actualizaci\u00f3n autom\u00e1ticamente.</p> <p>\u270f\ufe0fCuesti\u00f3n 7</p> <p>\u00bfPor qu\u00e9 podr\u00eda querer tener m\u00e1s de un servidor esclavo para una misma zona?</p> <p>Porque si un servidor esclavo falla o se desconecta, otros pueden seguir respondiendo a las consultas DNS. Esto es especialmente importante para garantizar que el servicio DNS siempre est\u00e9 disponible y no dependa de un solo servidor, de esta forma mejorar la resiliencia y la disponibilidad del servicio.</p> <p>\u270f\ufe0fCuesti\u00f3n 8</p> <p>\u00bfCu\u00e1ntos servidores ra\u00edz existen?</p> <p>Existen 13 servidores ra\u00edz en todo el mundo. Estos servidores son responsables de dirigir las consultas de DNS hacia los servidores de nombres autoritativos adecuados para resolver los dominios.</p> <p>Estos servidores son:</p> Letra Operador Direcci\u00f3n IPv4 A Verisign 198.41.0.4 B USC-ISI 192.228.79.201 C Cogent Communications 192.33.4.12 D Universidad de Maryland 199.7.91.139 E NASA 192.203.230.10 F Internet Systems Consortium 192.5.5.241 G Defense Information Systems 192.112.36.4 H U.S. Army Research Lab 128.63.2.53 I Netnod 192.36.148.17 J Verisign 192.58.128.30 K RIPE NCC 193.0.14.129 L ICANN 199.7.83.42 M Proyecto WIDE 202.12.27.33 <p>\u270f\ufe0fCuesti\u00f3n 9</p> <p>\u00bfQu\u00e9 es una consulta iterativa de referencia?</p> <p>Una consulta iterativa de referencia es cuando un servidor DNS no resuelve completamente una consulta, sino que devuelve una referencia a otro servidor que puede ser capaz de hacerelo. El cliente debe seguir consultando a esos servidores de referencia hasta obtener una respuesta definitiva. </p> <p>\u270f\ufe0fCuesti\u00f3n 10</p> <p>En una resoluci\u00f3n inversa, \u00bfa qu\u00e9 nombre se mapear\u00eda la direcci\u00f3n IP 172.16.34.56?</p> <p>En una resoluci\u00f3n inversa, la direcci\u00f3n IP <code>172.16.34.56</code> se convertir\u00eda en un nombre de dominio siguiendo la estructura de una zona de resoluci\u00f3n inversa. El resultado final se expresar\u00eda como:</p> <pre><code>56.34.16.172.in-addr.arpa\n</code></pre> <p>Autor: Jorge Pradillo Hinterberger</p>"}]}